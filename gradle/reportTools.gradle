import groovy.json.JsonBuilder

static Map nested(Node node) {
    def result = node.attributes()
    def children = new LinkedHashMap<String, List<Map>>()
    node.children().each { child ->
        String name = child.name()
        String childKeyName = "${name}List"
        List list = children.get(childKeyName)
        if (list == null)
            list = new LinkedList()
        list.add(nested(child))
        children.put(childKeyName, list)
    }
    result.putAll(children)
    return result
}

def xmlAsJson(String name, String filePath) {
    task(name) {
        File file = new File(project.buildDir, filePath)
        doLast {
            def xmlRoot = new XmlParser().parse(file)
            def jsonRoot = nested(xmlRoot)
            println file.name
            println new JsonBuilder(jsonRoot)
        }
    }
}

xmlAsJson("checkstyleAsJson", "reports/checkstyle/main.xml")
xmlAsJson("ktlintAsJson", "ktlint.xml")
xmlAsJson("testAsJson", "test-results/test/TEST-when#20page#20have#20Js#20redirects.xml")
xmlAsJson("lintAsJson", "lint-results.xml")